<!doctype html>
<html lang="en" class="h-full">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Forgot Password â€” Hi Interviews</title>
    <meta name="description" content="Reset your password for your Hi Interviews account." />

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        ink: { 50: '#f8fafc', 100: '#eef2f7', 200: '#e5eaf1', 300: '#cfd8e3', 400: '#94a3b8', 500: '#64748b', 600: '#475569', 700: '#334155', 800: '#1e293b', 900: '#0f172a', 950: '#0c1324' },
                        brand: { 50: '#eef2ff', 100: '#e0e7ff', 200: '#c7d2fe', 300: '#a5b4fc', 400: '#818cf8', 500: '#6366f1', 600: '#4f46e5', 700: '#4338ca', 800: '#3730a3', 900: '#312e81' },
                        'accent-iris': '#8B5CF6', 'accent-mint': '#10B981', 'accent-rose': '#F43F5E', 'accent-amber': '#FBBF24',
                    },
                    fontFamily: { sans: ["Inter", "system-ui", "sans-serif"], heading: ["Poppins", "sans-serif"] },
                    animation: {
                        'fade-in': 'fadeIn 0.5s ease-out forwards',
                        'scale-in': 'scaleIn 0.3s cubic-bezier(0.25,1,0.5,1) forwards',
                    },
                    keyframes: {
                        fadeIn: { '0%': { opacity: 0 }, '100%': { opacity: 1 } },
                        scaleIn: { '0%': { transform: 'scale(0.95)', opacity: '0' }, '100%': { transform: 'scale(1)', opacity: '1' } },
                    }
                }
            }
        }
    </script>
    <style>
        .focus-ring:focus-visible { outline: 2px solid rgba(79, 70, 229, .35); outline-offset: 3px }
        .bg-pattern { background-image: radial-gradient(circle at top, rgba(79,70,229,0.08) 0%, transparent 30%), radial-gradient(circle at bottom, rgba(139,92,246,0.08) 0%, transparent 40%); }
        .bg-glass { background-color: rgba(255, 255, 255, 0.7); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); }
        .otp-input { width: 100%; height: 3.5rem; text-align: center; font-size: 1.25rem; font-weight: 600; }
        .checkmark__circle { stroke-dasharray: 166; stroke-dashoffset: 166; stroke-width: 2; stroke-miterlimit: 10; stroke: #4f46e5; fill: none; animation: stroke 0.6s cubic-bezier(0.65, 0, 0.45, 1) forwards; }
        .checkmark__check { transform-origin: 50% 50%; stroke-dasharray: 48; stroke-dashoffset: 48; animation: stroke 0.3s cubic-bezier(0.65, 0, 0.45, 1) 0.8s forwards; }
        @keyframes stroke { 100% { stroke-dashoffset: 0; } }
    </style>
</head>
<body class="bg-ink-50 text-ink-950 antialiased font-sans min-h-screen flex flex-col">
    <header class="bg-white/80 backdrop-blur-sm border-b border-ink-100 absolute top-0 w-full z-10">
        <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <a href="trainer_signup.html" class="font-semibold tracking-tight text-xl font-heading text-ink-900">Hi Interviews</a>
                <a href="trainer_login.html" class="text-sm font-medium text-brand-600 hover:text-brand-800 flex items-center gap-2">
                    <i class="fa-solid fa-arrow-left"></i> Back to Login
                </a>
            </div>
        </div>
    </header>

    <main class="flex-grow w-full flex flex-col items-center justify-center p-4 bg-pattern">
        <div class="bg-glass rounded-2xl shadow-lift ring-1 ring-black/5 w-full max-w-md">
            <div class="p-8">
                <!-- Step 1: Enter Email -->
                <div id="email-step" class="animate-fade-in">
                    <div class="text-center">
                        <h1 class="text-2xl font-bold text-ink-800">Forgot Password</h1>
                        <p class="text-sm text-ink-600 mt-2">No worries, we'll send you reset instructions.</p>
                    </div>
                    <form id="email-form" class="mt-8 space-y-6">
                        <div class="relative">
                            <label for="email" class="text-sm font-medium text-ink-700 sr-only">Email Address</label>
                             <i class="fa-solid fa-envelope absolute left-4 top-1/2 -translate-y-1/2 text-ink-400"></i>
                            <input id="email" name="email" type="email" autocomplete="email" required
                                   class="w-full h-12 pl-12 pr-4 rounded-lg border border-ink-200 bg-white focus-ring"
                                   placeholder="you@example.com">
                        </div>
                        <button type="submit" id="send-otp-btn" class="w-full bg-brand-600 text-white font-medium py-3 px-5 rounded-lg hover:bg-brand-700 transition focus-ring">
                            Send OTP
                        </button>
                    </form>
                </div>

                <!-- Step 2: Enter OTP & New Password -->
                <div id="otp-step" class="hidden animate-fade-in">
                     <div class="text-center">
                        <h1 class="text-2xl font-bold text-ink-800">Check your email</h1>
                        <p class="text-sm text-ink-600 mt-2">We've sent a 6-digit code to <strong id="user-email-display"></strong>.</p>
                    </div>
                    <form id="otp-form" class="mt-8 space-y-6">
                        <div>
                            <label class="text-sm font-medium text-ink-700 text-center block">Enter 6-Digit Code</label>
                            <div id="otp-inputs" class="flex justify-center gap-2 mt-2">
                                <input type="text" maxlength="1" class="otp-input rounded-lg border border-ink-200 bg-white focus-ring">
                                <input type="text" maxlength="1" class="otp-input rounded-lg border border-ink-200 bg-white focus-ring">
                                <input type="text" maxlength="1" class="otp-input rounded-lg border border-ink-200 bg-white focus-ring">
                                <input type="text" maxlength="1" class="otp-input rounded-lg border border-ink-200 bg-white focus-ring">
                                <input type="text" maxlength="1" class="otp-input rounded-lg border border-ink-200 bg-white focus-ring">
                                <input type="text" maxlength="1" class="otp-input rounded-lg border border-ink-200 bg-white focus-ring">
                            </div>
                        </div>
                        <div class="relative">
                            <label for="new-password" class="text-sm font-medium text-ink-700 sr-only">New Password</label>
                             <i class="fa-solid fa-lock absolute left-4 top-1/2 -translate-y-1/2 text-ink-400"></i>
                            <input id="new-password" name="new-password" type="password" required
                                   class="w-full h-12 pl-12 pr-10 rounded-lg border border-ink-200 bg-white focus-ring" placeholder="New Password">
                            <button type="button" class="password-toggle absolute right-3 top-1/2 -translate-y-1/2 text-ink-400">
                               <i class="fa-solid fa-eye"></i>
                            </button>
                        </div>
                         <div class="relative">
                            <label for="confirm-password" class="text-sm font-medium text-ink-700 sr-only">Confirm New Password</label>
                             <i class="fa-solid fa-lock absolute left-4 top-1/2 -translate-y-1/2 text-ink-400"></i>
                            <input id="confirm-password" name="confirm-password" type="password" required
                                   class="w-full h-12 pl-12 pr-4 rounded-lg border border-ink-200 bg-white focus-ring" placeholder="Confirm New Password">
                        </div>
                        <button type="submit" id="reset-password-btn" class="w-full bg-brand-600 text-white font-medium py-3 px-5 rounded-lg hover:bg-brand-700 transition focus-ring">
                            Reset Password
                        </button>
                    </form>
                </div>

                <!-- Step 3: Success -->
                <div id="success-step" class="hidden text-center animate-fade-in">
                     <div class="mx-auto h-20 w-20">
                         <svg class="checkmark" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 52 52">
                            <circle class="checkmark__circle" cx="26" cy="26" r="25"/>
                            <path class="checkmark__check" fill="none" stroke="#4f46e5" stroke-width="4" stroke-linecap="round" d="M14 27l5.917 4.917L38.083 22"/>
                        </svg>
                    </div>
                    <h1 class="text-2xl font-bold text-ink-800 mt-4">Password Reset!</h1>
                    <p class="text-sm text-ink-600 mt-2">Your password has been successfully reset. Click below to log in.</p>
                    <a href="trainer_login.html" class="mt-8 inline-block w-full bg-brand-600 text-white font-medium py-3 px-5 rounded-lg hover:bg-brand-700 transition focus-ring">
                        Back to Login
                    </a>
                </div>
            </div>
        </div>

        <div class="text-center mt-6">
            <div class="bg-amber-50 border border-amber-200 rounded-lg p-4 max-w-md mx-auto text-sm text-amber-800">
                <p><strong>Still having trouble?</strong> Drop an email to <a href="mailto:support@hiinterviews.com" class="font-semibold underline">support@hiinterviews.com</a> from your registered email address. Our team will reach out to you within 24 hours.</p>
            </div>
        </div>
    </main>
     <script src="scripts/script.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {

             checkWebsiteStatus().then(active => {
                 if (!active) return; 
            });
            const emailStep = document.getElementById('email-step');
            const otpStep = document.getElementById('otp-step');
            const successStep = document.getElementById('success-step');
            
            const emailForm = document.getElementById('email-form');
            const otpForm = document.getElementById('otp-form');
            
            const userEmailDisplay = document.getElementById('user-email-display');
            const otpInputs = document.querySelectorAll('#otp-inputs input');
            const passwordToggles = document.querySelectorAll('.password-toggle');

            function showStep(step) {
                emailStep.classList.add('hidden');
                otpStep.classList.add('hidden');
                successStep.classList.add('hidden');
                step.classList.remove('hidden');
                step.classList.add('animate-scale-in');
            }

            emailForm.addEventListener('submit', async function(e) {
                e.preventDefault();
                const email = document.getElementById('email').value;
                if (email) {

                   

                  try{

                     

                
    
                    const response =  await fetch('https://sandbox.hiinterviews.com/hiinterview_backend/api/auth/trainer/reset-password-otp/',{

                    method: "POST",
                    headers:{"Content-Type":"application/json"},
                    body:JSON.stringify({email:email})
                    
                    })

                    const data = await response.json()

                    if (response.ok){
                        console.log("res",response)
                        
                        localStorage.clear();

                        localStorage.setItem("secret_key",data.secret_key)
                        
                        localStorage.setItem('email',email)
                         userEmailDisplay.textContent = email;
                         console.log(`Simulating OTP sent to ${email}`);
                         showStep(otpStep);
                         otpInputs[0].focus();

                    }
                    else{
                        alert(data.error || "failed to send otp to mail")
                    }
                      }
                      catch(error){
                        console.error(error)
                      }
                   
                }
            });

            function getOtpValue(){

                    let otpInputs = document.querySelectorAll("#otp-inputs .otp-input");
                    let otp = "";
                    otpInputs.forEach(input=>{
                        otp += input.value;
                    })
                    return otp;

            }

            otpForm.addEventListener('submit', async function(e) {
                e.preventDefault();
                const newPassword = document.getElementById('new-password').value;
                const confirmPassword = document.getElementById('confirm-password').value;

                const OtpValue = getOtpValue();
                
                if (newPassword !== confirmPassword) { alert("Passwords do not match!"); return; }
                if (newPassword.length < 8) { alert("Password must be at least 8 characters long."); return; }
                
                console.log("Simulating password reset...");

                const email = localStorage.getItem("email");
                const secret_key = localStorage.getItem('secret_key');

                if (newPassword && confirmPassword && OtpValue) {

                  try{

                    const response = await fetch('https://sandbox.hiinterviews.com/hiinterview_backend/api/auth/verify-password-reset-otp/',{
                    method: "POST",
                    headers:{"Content-Type":"application/json"},
                    body:JSON.stringify({email:email,
                        password:newPassword,
                        otpValue:OtpValue,
                        secret_key:secret_key
                    })
                    })

                    if (response.ok){
                         showStep(successStep);
                    }
                    else{
                        alert(response.error || "failed to verify otp")
                    }
                      }
                      catch(error){
                        console.error(error)
                      }
                   
                }

              
            });

            otpInputs.forEach((input, index) => {
                input.addEventListener('input', () => {
                    if (input.value.length === 1 && index < otpInputs.length - 1) {
                        otpInputs[index + 1].focus();
                    }
                });
                input.addEventListener('keydown', (e) => {
                    if (e.key === 'Backspace' && input.value.length === 0 && index > 0) {
                        otpInputs[index - 1].focus();
                    }
                });
            });

            passwordToggles.forEach(toggle => {
                toggle.addEventListener('click', () => {
                    const passwordInput = toggle.previousElementSibling;
                    const icon = toggle.querySelector('i');
                    if (passwordInput.type === 'password') {
                        passwordInput.type = 'text';
                        icon.classList.remove('fa-eye');
                        icon.classList.add('fa-eye-slash');
                    } else {
                        passwordInput.type = 'password';
                        icon.classList.remove('fa-eye-slash');
                        icon.classList.add('fa-eye');
                    }
                });
            });
        });
    </script>
</body>
</html>

