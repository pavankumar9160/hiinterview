<!doctype html>
<html lang="en" class="h-full">
<head>
 <meta charset="utf-8" />
 <meta name="viewport" content="width=device-width, initial-scale=1" />
 <title>Service Store — Hi Interviews</title>
 <meta name="description" content="Explore and purchase our range of one-to-one mentorship and career support services." />

 <link rel="preconnect" href="https://fonts.googleapis.com">
 <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
 <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
 <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />

 <script src="https://cdn.tailwindcss.com"></script>
 <script>
 tailwind.config = {
 theme: {
 extend: {
 colors: {
 ink: { 50: '#f8fafc', 100: '#eef2f7', 200: '#e5eaf1', 300: '#cfd8e3', 400: '#94a3b8', 500: '#64748b', 600: '#475569', 700: '#334155', 800: '#1e293b', 900: '#0f172a', 950: '#0c1324' },
 brand: { 50: '#eef2ff', 100: '#e0e7ff', 200: '#c7d2fe', 300: '#a5b4fc', 400: '#818cf8', 500: '#6366f1', 600: '#4f46e5', 700: '#4338ca', 800: '#3730a3', 900: '#312e81' },
 gold: { 500: '#ca8a04' }
 },
 fontFamily: { sans: ["Inter", "system-ui", "sans-serif"], heading: ["Poppins", "sans-serif"] },
 animation: { 
 'fade-in': 'fadeIn 0.35s ease-out forwards',
 'slide-up': 'slideUp 0.45s ease-out forwards'
 },
 keyframes: { 
 fadeIn: { '0%': { opacity: 0 }, '100%': { opacity: 1 } },
 slideUp: { '0%': { opacity: 0, transform: 'translateY(10px)' }, '100%': { opacity: 1, transform: 'translateY(0)' } }
 }
 }
 }
 }
 </script>

 <style>
 .focus-ring:focus-visible { outline: 3px solid rgba(99,102,241,.12); outline-offset: 3px }
 .bg-pattern { background-image: radial-gradient(circle at top left, rgba(99,102,241,0.06) 0%, transparent 25%), radial-gradient(circle at bottom right, rgba(236,72,153,0.04) 0%, transparent 30%); }
 .hide-scrollbar::-webkit-scrollbar { display: none; }
 .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
 .card-hover { transition: transform .28s cubic-bezier(.2,.9,.2,1), box-shadow .28s; }
 .card-hover:hover { transform: translateY(-8px) scale(1.004); box-shadow: 0 18px 40px rgba(15,23,42,0.09); }
 [data-tooltip] { position: relative; cursor: pointer; }
 [data-tooltip]::after { content: attr(data-tooltip); position: absolute; bottom: 100%; left: 50%; transform: translateX(-50%); margin-bottom: 8px; background-color: #0f172a; color: white; padding: 6px 10px; border-radius: 6px; font-size: 12px; font-weight: 600; white-space: nowrap; opacity: 0; pointer-events: none; transition: opacity 0.15s ease-out; z-index: 10; }
 [data-tooltip]:hover::after { opacity: 1; }

 .alacarte-locked { position: relative; }
 .alacarte-locked .lock-overlay { position: absolute; inset: 0; display:flex; align-items:center; justify-content:center; background: linear-gradient(180deg, rgba(255,255,255,0.85), rgba(255,255,255,0.7)); backdrop-filter: blur(4px); z-index: 10; font-weight:700; color:#334155; padding:1rem; text-align:center; border-radius:.75rem; }
 .alacarte-locked .add-to-cart-btn { background-color: transparent; color: #94a3b8; border: 1px dashed #e6eef9; cursor: not-allowed; pointer-events: none; opacity: .9; }

 .slider-dot { height: 8px; width: 8px; border-radius: 9999px; background: rgba(255,255,255,.45); transition: width .2s, background .2s; }
 .slider-dot.w-4 { width: 28px; border-radius: 9999px; }

 .card-desc { display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; overflow: hidden; }

 .modal-backdrop { background: rgba(2,6,23,0.6); }
 .modal { max-width: 760px; width: 95%; border-radius: 12px; }

 /* Toast */
 .toast-container { position: fixed; right: 1rem; bottom: 1rem; z-index: 60; display:flex; flex-direction:column; gap:0.5rem; }
 .toast { background: white; border-left: 4px solid #6366f1; padding: 0.75rem 1rem; border-radius: 8px; box-shadow: 0 6px 20px rgba(2,6,23,0.08); min-width: 240px; font-weight:600; }
 .toast.success { border-left-color: #16a34a; }
 .toast.error { border-left-color: #ef4444; }
 </style>
</head>
<!-- Spinner overlay -->
<div id="spinner" class="fixed inset-0 flex items-center justify-center bg-white z-50" style="display:flex">
    <div class="w-12 h-12 border-4 border-brand-200 border-t-brand-600 rounded-full animate-spin"></div>
</div>
<body class="bg-ink-50 text-ink-900 antialiased font-sans min-h-screen flex flex-col content" style="display:none">

 <header class="bg-white/90 backdrop-blur-sm border-b border-ink-100 sticky top-0 z-40">
 <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
 <div class="flex justify-between items-center h-16 gap-4">
 <a href="#" class="flex items-center gap-3" aria-label="Hi Interviews home">
 <div class="h-10 w-10 rounded-lg bg-gradient-to-br from-brand-600 to-brand-800 text-white flex items-center justify-center font-bold">HI</div>
 <div>
 <div class="font-semibold tracking-tight text-lg font-heading text-ink-900">Hi Interviews</div>
 <div class="text-xs text-ink-500 -mt-0.5">Service Store</div>
 </div>
 </a>

 <div class="flex-1 mx-6 hidden md:block">
 <div class="max-w-2xl mx-auto relative">
 <input id="searchInput" aria-label="Search services" type="search" placeholder="Search services (e.g. mock interview, resume, mentorship)" class="w-full rounded-full border border-ink-200 px-4 py-3 pl-4 shadow-sm focus-ring" />
 <button id="searchBtn" aria-label="Search" class="absolute right-1 top-1/2 -translate-y-1/2 bg-brand-600 text-white px-4 py-2 rounded-full font-medium focus-ring"><i class="fa-solid fa-magnifying-glass"></i></button>
 </div>
 </div>

 <div class="flex items-center gap-3">
 <nav class="hidden sm:flex items-center gap-2">
 <button class="p-2 rounded-full focus-ring" title="Wishlist"><i class="fa-regular fa-heart text-ink-500"></i></button>
 <button id="cart-btn" aria-haspopup="dialog" aria-controls="cart-sidebar" class="relative p-2 rounded-full focus-ring bg-white border border-ink-100 shadow-sm" title="Cart">
 <i class="fa-solid fa-shopping-cart text-ink-700"></i>
 <span id="cart-badge" class="absolute -top-1 -right-1 h-5 w-5 bg-rose-500 text-white text-[10px] rounded-full flex items-center justify-center hidden" aria-live="polite">0</span>
 </button>
 </nav>
 <button id="profileBtn" class="h-10 w-10 rounded-full bg-brand-600 text-white focus-ring flex items-center justify-center ring-4 ring-brand-200 relative animate-glow-pulse overflow-hidden" aria-label="Open profile menu" fdprocessedid="xlsam">
            <img id="profileAvatar" class="img-circle" src="" alt="Guest" style="display:none">
            <span id="profileInitial" class="font-bold" style="display: block;">Guest</span> </div>
 </div>
 </div>
 </header>

 <main class="flex-grow bg-pattern py-8 md:py-12">
 <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
 <div class="text-center">
 <h1 class="text-4xl lg:text-5xl font-bold font-heading text-ink-900">Our Services</h1>
 <p class="mt-3 max-w-2xl mx-auto text-lg text-ink-600">One-to-one mentorship and support to accelerate your tech career. Clear microcopy, inline validation and friendly guidance across the experience.</p>
 </div>

 <!-- PROMO SLIDER -->
 <section id="promo-slider-container" class="mt-10 mb-8 relative w-full max-w-4xl mx-auto h-48 rounded-2xl overflow-hidden" aria-roledescription="carousel">
 <div id="promo-slider" class="flex h-full transition-transform duration-500 ease-in-out" tabindex="0"></div>
 <div id="slider-dots" class="absolute bottom-4 left-1/2 -translate-x-1/2 flex gap-2" role="tablist" aria-label="Promotions"></div>
 </section>

 <!-- FILTERS -->
 <div id="filters-container" class="mb-6 flex flex-wrap justify-center gap-3" role="tablist" aria-label="Service filters">
 <button data-filter="all" class="filter-btn bg-brand-600 text-white px-4 py-2 rounded-full text-sm font-semibold focus-ring" aria-pressed="true">All Services</button>
 <button data-filter="core" class="filter-btn bg-white hover:bg-ink-50 text-ink-700 px-4 py-2 rounded-full text-sm font-semibold focus-ring border border-ink-200" aria-pressed="false">Core Programs</button>
 <button data-filter="alacarte" class="filter-btn bg-white hover:bg-ink-50 text-ink-700 px-4 py-2 rounded-full text-sm font-semibold focus-ring border border-ink-200" aria-pressed="false">À La Carte Services</button>
 </div>

 <!-- PAST PURCHASE TOGGLE -->
 <div class="max-w-3xl mx-auto my-6 p-4 bg-white border border-ink-100 rounded-xl shadow-sm">
 <label class="flex items-start gap-4 cursor-pointer">
 <input id="past-purchase-checkbox" type="checkbox" class="h-5 w-5 rounded border-ink-300 text-brand-600 focus:ring-brand-500 mt-0.5 flex-shrink-0" aria-describedby="past-purchase-desc">
 <div>
 <span class="font-semibold text-ink-800">I purchased a Core Program in the past year.</span>
 <p id="past-purchase-desc" class="text-sm text-ink-500 mt-1">Enable this to unlock À La Carte purchases without adding a Core Program now.</p>
 </div>
 </label>
 </div>

 <!-- PRODUCTS -->
 <div id="product-container" class="space-y-12" aria-live="polite"></div>
 </div>
 </main>

 <!-- INFO MODAL -->
 <div id="info-modal" class="fixed inset-0 hidden z-50 modal-backdrop items-center justify-center p-4" role="dialog" aria-modal="true" aria-labelledby="info-modal-title">
 <div class="bg-white rounded-2xl max-w-2xl w-full shadow-2xl p-6 animate-slide-up relative" id="info-modal-panel">
 <button id="close-info-modal" class="absolute top-3 right-3 h-8 w-8 rounded-full hover:bg-ink-100 focus-ring flex items-center justify-center text-2xl font-light" aria-label="Close information modal">&times;</button>
 <h2 id="info-modal-title" class="text-2xl font-bold font-heading text-ink-900 mb-4">Why Our Services Work</h2>
 <div class="space-y-4 text-ink-700 text-sm leading-relaxed">
 <p><strong>Interview Buddy Day</strong> is live, real-time support for interview loops — from last-minute confidence boosts to on-call problem solving.</p>
 <p><strong>One-to-One Training</strong> focuses on you: customized lessons, curated projects, and one-on-one feedback to ensure job readiness.</p>
 <p><strong>Post-Job Support</strong> helps you transition smoothly into a role and solve early-stage challenges with expert guidance.</p>
 </div>
 <div class="mt-6 text-right">
 <button id="close-info-btn" class="bg-brand-600 text-white px-5 py-2 rounded-lg hover:bg-brand-700 focus-ring font-medium">Got it!</button>
 </div>
 </div>
 </div>

 <div id="cart-sidebar-backdrop" class="fixed inset-0 bg-black/50 z-40 hidden animate-fade-in"></div>
 <aside id="cart-sidebar" class="fixed top-0 right-0 h-full w-full max-w-md bg-white shadow-lg transform translate-x-full transition-transform duration-300 z-50 flex flex-col" aria-labelledby="cart-heading" role="dialog" aria-modal="true" aria-hidden="true">
 <div class="p-4 flex justify-between items-center border-b flex-shrink-0">
 <h2 id="cart-heading" class="text-xl font-bold">Your Cart</h2>
 <button id="close-cart-btn" class="h-8 w-8 flex items-center justify-center rounded-full hover:bg-ink-100 focus-ring text-2xl font-light" aria-label="Close cart">&times;</button>
 </div>
 <div id="cart-items-container" class="flex-grow p-4 overflow-y-auto hide-scrollbar" tabindex="0"></div>
 <div class="p-4 border-t bg-ink-50 flex-shrink-0">
 <div class="space-y-2 text-sm">
 <div class="pt-2 pb-3">
 <label for="coupon-input" class="text-sm font-medium text-ink-700">Apply Coupon</label>
 <div class="mt-1 flex gap-2">
 <input id="coupon-input" type="text" placeholder="Enter coupon code" class="w-full rounded-md px-3 py-2 border border-ink-200 focus-ring" aria-describedby="coupon-help" />
 <button id="apply-coupon-btn" class="bg-brand-600 text-white px-4 py-2 rounded-md hover:bg-brand-700 transition focus-ring font-medium flex-shrink-0">Apply</button>
 </div>
 <div id="coupon-msg" class="text-xs mt-1.5 h-4" role="status" aria-live="polite"></div>
 <div id="coupon-display-row" class="hidden flex items-center gap-2 mt-2 text-green-600">
 <span class="bg-green-50 text-green-700 px-2 py-1 rounded-sm text-xs font-medium" id="applied-coupon-pill"></span>
 <button id="remove-coupon-btn" class="text-xs underline text-ink-600">Remove</button>
 </div>
 </div>
 <div class="flex justify-between font-semibold"><span>Subtotal</span><span id="cart-subtotal">₹0</span></div>
 <div class="flex justify-between"><span>Coupon Discount</span><span id="cart-discount">-₹0</span></div>
 <div class="flex justify-between"><span>Tax (18% GST)</span><span id="cart-gst">₹0</span></div>
 <div class="flex justify-between"><span>Platform Fee (2%)</span><span id="cart-platform-fee">₹0</span></div>
 <div class="flex justify-between text-lg font-bold pt-2 border-t mt-2 text-ink-900"><span>Total</span><span id="cart-total">₹0</span></div>
 <button id="checkout-btn"  class="block w-full text-center mt-4 bg-ink-800 text-white font-medium py-3 px-5 rounded-lg hover:bg-ink-950 transition focus-ring">Proceed to Checkout</button>
 </div>
 </div>
 </aside>

 <!-- Toast container -->
 <div class="toast-container" id="toastContainer" aria-live="polite" aria-atomic="true"></div>

  <script src="scripts/script.js"></script>
 <script>
 document.addEventListener('DOMContentLoaded', async function(){


     checkWebsiteStatus().then(active => {
                 if (!active) return; 
            });

 /*********************
 * DATA (unchanged)
 *********************/


/*const allServices = [
 { id: 'ks', type: 'core', name: 'Knowledge Series', price: 59999, description: 'Comprehensive one-to-one training from scratch, designed to make you a job-ready expert in your chosen domain.', features: ['1-on-1 Daily Classes', 'Flexible Timings (8am-10pm)', 'Project-Based Learning', 'Personalized Syllabus', 'Beginner Friendly', 'Resume Building'], applicableDomains: ['Full Stack Python', 'Full Stack Java', 'Full Stack JS', 'SAP Abap', 'AWS', 'Accessibility Testing', 'Database (MySQL, PL/SQL)', 'Front End Dev (React JS)', 'Mobile App Dev (React Native)'] },
 { id: 'js', type: 'core', name: 'Job Series', price: 59999, description: 'Intensive one-to-one interview preparation with mock interviews and concept revision to help you crack your dream job.', features: ['1-on-1 Mock Interviews', 'Domain Concept Brush-Up', 'Requires Basic Knowledge', 'Flexible Timings (8am-10pm)', '30-45 Day Program', 'Resume Building'], applicableDomains: ['Full Stack Python', 'Full Stack Java', 'Full Stack JS', 'SAP Abap', 'AWS', 'Accessibility Testing', 'Database (MySQL, PL/SQL)', 'Front End Dev (React JS)', 'Mobile App Dev (React Native)'] },
 { id: 'ps', type: 'core', name: 'Premium Series', price: 129998, originalPrice: 179998, description: 'The ultimate all-in-one package combining complete training, job preparation, and dedicated interview day support.', features: ['Includes Full Knowledge Series', 'Includes Full Job Series', '5 Interview Buddy Days', 'End-to-End Personal Mentorship', 'Flat ₹50,000 Discount'], applicableDomains: ['Full Stack Python', 'Full Stack Java', 'Full Stack JS', 'SAP Abap', 'AWS', 'Accessibility Testing', 'Database (MySQL, PL/SQL)', 'Front End Dev (React JS)', 'Mobile App Dev (React Native)'] },
 { id: 'ibd1', type: 'alacarte', name: 'Interview Buddy Day (1 Day)', price: 12000, description: 'Real-time expert support during your interview process.'},
 { id: 'ibd2', type: 'alacarte', name: 'Interview Buddy Day (2 Days)', price: 22000, description: 'Perfect for multi-day interview loops.' },
 { id: 'ibd3', type: 'alacarte', name: 'Interview Buddy Day (3 Days)', price: 30000, description: 'Ideal for extensive final rounds.' },
 { id: 'ibd4', type: 'alacarte', name: 'Interview Buddy Day (4 Days)', price: 35000, description: 'Comprehensive support for a full week.' },
 { id: 'ibd5', type: 'alacarte', name: 'Interview Buddy Day (5 Days)', price: 40000, description: 'Best value for a critical interview week.' },
 { id: 'sd1', type: 'alacarte', name: 'Support: Understand Requirement', price: 999, description: 'We clarify your work/project requirement for you.' },
 { id: 'sd2', type: 'alacarte', name: 'Support: Explain Requirement', price: 1999, description: 'We explain how to approach and execute your task.' },
 { id: 'sd3', type: 'alacarte', name: 'Support: Completion (Mini)', price: 3499, description: 'We complete and submit a small task for you.' },
 { id: 'sd4', type: 'alacarte', name: 'Support: Completion (Medium)', price: 4499, description: 'We complete and submit a medium-sized task.' },
 { id: 'sd5', type: 'alacarte', name: 'Support: Completion (Large)', price: 6999, description: 'We handle the completion of a large, complex task.' },
 { id: 'cg', type: 'alacarte', name: 'Career Gap Consultancy', price: 34999, description: 'A complete solution with strategy and documentation to address career gaps.' },
 { id: 'cc', type: 'alacarte', name: '1-to-1 Career Consultancy', price: 7999, description: 'A focused session with a senior consultant for any career challenge.' },
 ]; */

 const promoSlides = [
 { title: 'Flat ₹2,000 Off!', subtitle: 'Use code SEPT2000 on all Core Programs.', bg: 'bg-gradient-to-br from-brand-600 to-brand-800' },
 { title: 'Exclusive Bank Offers', subtitle: 'Get an extra ₹3,000 OFF with select bank cards.', bg: 'bg-gradient-to-br from-ink-800 to-ink-950' },
 { title: 'Slots Filling Fast for 2025!', subtitle: 'Hurry — few seats left. Next batch starts in 2026.', bg: 'bg-gradient-to-br from-rose-600 to-rose-800' }
 ];

 const validCoupons = { 'SEPT2000': 2000, 'CITI3000': 3000, 'HSBC3000': 3000, 'ONECARD3000': 3000 };

 /*********************
 * STATE
 *********************/

 localStorage.removeItem('cart');
 localStorage.removeItem('total')

 let cart = [];
 let appliedCoupon = null;
 let sliderInterval = null;
 let currentSliderIndex = 0;
 let searchTimeout = null;

 /*********************
 * DOM REFS
 *********************/
 const productContainer = document.getElementById('product-container');
 const cartBtn = document.getElementById('cart-btn');
 const closeCartBtn = document.getElementById('close-cart-btn');
 const cartSidebar = document.getElementById('cart-sidebar');
 const cartBackdrop = document.getElementById('cart-sidebar-backdrop');
 const cartItemsContainer = document.getElementById('cart-items-container');
 const cartSubtotalEl = document.getElementById('cart-subtotal');
 const cartDiscountEl = document.getElementById('cart-discount');
 const couponDisplayRow = document.getElementById('coupon-display-row');
 const cartGstEl = document.getElementById('cart-gst');
 const cartPlatformFeeEl = document.getElementById('cart-platform-fee');
 const cartTotalEl = document.getElementById('cart-total');
 const cartBadge = document.getElementById('cart-badge');
 const couponInput = document.getElementById('coupon-input');
 const applyCouponBtn = document.getElementById('apply-coupon-btn');
 const couponMsg = document.getElementById('coupon-msg');
 const pastPurchaseCheckbox = document.getElementById('past-purchase-checkbox');
 const modal = document.getElementById('info-modal');
 const closeInfoModalBtn = document.getElementById('close-info-modal');
 const closeInfoBtn = document.getElementById('close-info-btn');
 const toastContainer = document.getElementById('toastContainer');
 const promoSliderEl = document.getElementById('promo-slider');
 const dotsContainer = document.getElementById('slider-dots');
 const searchInput = document.getElementById('searchInput');
 const searchBtn = document.getElementById('searchBtn');

 const currencyFormatter = new Intl.NumberFormat('en-IN', { style: 'currency', currency: 'INR', minimumFractionDigits: 0, maximumFractionDigits: 0 });

 /*********************
 * UTIL: Toasts
 *********************/
 const showToast = (message, type = 'success', ttl = 3000) => {
 const el = document.createElement('div');
 el.className = `toast ${type === 'success' ? 'success' : type === 'error' ? 'error' : ''}`;
 el.textContent = message;
 toastContainer.appendChild(el);
 setTimeout(() => el.style.transform = 'translateY(-6px)', 20);
 const remove = () => {
 el.style.opacity = '0';
 el.style.transform = 'translateY(8px)';
 setTimeout(() => el.remove(), 220);
 };
 setTimeout(remove, ttl);
 el.addEventListener('click', remove);
 };

 /*********************
 * SLIDER (accessible)
 *********************/
 const initSlider = () => {
 promoSliderEl.innerHTML = promoSlides.map(slide => `<div class="w-full h-full flex-shrink-0 ${slide.bg} flex flex-col items-center justify-center text-white p-4 text-center" role="group" aria-roledescription="slide"><h3 class="text-2xl font-bold font-heading">${slide.title}</h3><p class="mt-1">${slide.subtitle}</p></div>`).join('');
 dotsContainer.innerHTML = promoSlides.map((_, i) => `<button data-slide-to="${i}" class="slider-dot h-2 w-2 rounded-full bg-white/50 transition" aria-label="Go to slide ${i+1}" role="tab"></button>`).join('');
 const dots = Array.from(dotsContainer.children);
 const showSlide = (n) => {
 currentSliderIndex = n;
 promoSliderEl.style.transform = `translateX(-${n * 100}%)`;
 dots.forEach((d, idx) => {
 d.classList.toggle('bg-white', idx === n);
 d.setAttribute('aria-pressed', idx === n ? 'true' : 'false');
 });
 };
 const nextSlide = () => showSlide((currentSliderIndex + 1) % promoSlides.length);
 const resetInterval = () => { clearInterval(sliderInterval); sliderInterval = setInterval(nextSlide, 5000); };
 dotsContainer.addEventListener('click', (e) => {
 if (e.target.matches('.slider-dot')) {
 const i = Number(e.target.dataset.slideTo);
 showSlide(i);
 resetInterval();
 }
 });
 // keyboard navigation
 promoSliderEl.addEventListener('keydown', (e) => {
 if (e.key === 'ArrowLeft') { showSlide((currentSliderIndex - 1 + promoSlides.length) % promoSlides.length); resetInterval(); }
 if (e.key === 'ArrowRight') { showSlide((currentSliderIndex + 1) % promoSlides.length); resetInterval(); }
 });
 showSlide(0);
 resetInterval();
 };

 /*********************
 * HELPERS
 *********************/
let isCore = (item) => item.type === 'core';
let isAlacarte = (item) => item.type === 'alacarte';
const enforceAlacarteLock = () => {
    const hasCore = cart.some(isCore);  
    if (!hasCore) {
        cart = cart.filter(item => !isAlacarte(item));  
    }
};


 /*********************
 * RENDER PRODUCTS
 *********************/
const renderProducts = (filter = 'all', searchTerm = '') => {
    // Check if any core service is in the cart
    const alaCarteUnlocked = cart.some(item => item.type === 'core') || pastPurchaseCheckbox.checked;

    const servicesToRender = allServices
        .filter(s => filter === 'all' || s.type === filter)
        .filter(s => {
            if (!searchTerm) return true;
            const t = searchTerm.toLowerCase();

            // Ensure applicableDomains is an array
            const domains = Array.isArray(s.applicableDomains) ? s.applicableDomains : [];

            return (s.name + ' ' + (s.description || '') + ' ' + domains.join(' '))
                .toLowerCase()
                .includes(t);
        });

    // Separate core and alacarte services
    const coreServices = servicesToRender.filter(s => s.type === 'core');
    const alaCarteServices = servicesToRender.filter(s => s.type === 'alacarte');

    // Now you can render coreServices and alaCarteServices in the UI


 let html = '';
 if (coreServices.length > 0) {
 html += `<section id="core-programs"><h2 class="text-3xl font-bold font-heading text-ink-800 text-center">Core Programs</h2><div class="mt-8 grid grid-cols-1 lg:grid-cols-3 gap-8">`;
 html += coreServices.map(s => {
 const hasDomain = (s.applicableDomains && s.applicableDomains.length);
 return `
 <article id="service-${s.id}" class="bg-white rounded-2xl shadow-lg shadow-ink-200/50 p-6 flex flex-col transition-all duration-300 card-hover animate-slide-up">
 <div class="flex-grow">
 ${s.originalPrice ? `<div class="bg-rose-500 text-white text-xs font-bold px-3 py-1 rounded-full shadow-md inline-block mb-3">Limited Time Offer</div>` : ''}
 <h3 class="text-2xl font-bold font-heading text-ink-900">${s.name}</h3>
 <p class="text-ink-600 mt-3 mb-4 card-desc">${s.description}</p>
 <div class="flex items-start justify-between gap-6">
 <div>
 <div class="text-3xl font-bold font-heading text-brand-600">${currencyFormatter.format(s.price)}${s.originalPrice ? `<span class="text-xl text-ink-400 line-through ml-3">${currencyFormatter.format(s.originalPrice)}</span>` : ''}</div>
 <ul class="mt-4 space-y-2 text-ink-700">${s.features.map(f => `<li class="flex items-center gap-3"><i class="fa-solid fa-check-circle text-brand-500"></i><span>${f}</span></li>`).join('')}</ul>
 </div>
 <div class="w-44">
 ${hasDomain ? `<label class="text-sm font-medium text-ink-700">Domain</label>
 <select class="domain-select mt-2 w-full rounded-md border border-ink-200 px-3 py-2 shadow-sm focus-ring" aria-label="Choose domain for ${s.name}">
 <option value="">-- Select --</option>
 ${s.applicableDomains?.map(d => `<option value="${d}">${d}</option>`).join('')}
 </select>` : `<div class="text-sm text-ink-500">No domain selection needed</div>`}
 </div>
 </div>
 </div>
 <div class="mt-6 grid grid-cols-2 gap-3">
 <button data-id="${s.id}" class="add-to-cart-btn w-full bg-ink-800 text-white font-medium py-3 rounded-lg hover:bg-ink-950 transition focus-ring">Add to Cart</button>
 <button data-id="${s.id}" class="info-btn w-full border border-ink-200 rounded-lg py-3 font-medium hover:bg-ink-50 focus-ring">Info</button>
 </div>
 </article>`;
 }).join('');
 html += `</div></section>`;
 }
 if (alaCarteServices.length > 0) {
 html += `<section id="alacarte-services" class="pt-12"><h2 class="text-3xl font-bold font-heading text-ink-800 text-center">À La Carte Services</h2><div class="mt-8 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">`;
 html += alaCarteServices.map(s => `
 <article id="service-${s.id}" class="bg-white rounded-xl shadow-lg shadow-ink-200/50 p-6 flex flex-col justify-between transition-all duration-300 card-hover animate-slide-up relative overflow-hidden ${!alaCarteUnlocked ? 'alacarte-locked' : ''}">
 <div><h3 class="text-lg font-bold font-heading text-ink-900">${s.name}</h3><p class="text-sm text-ink-600 mt-3 mb-4 card-desc">${s.description}</p></div>
 <div class="flex items-center justify-between mt-4">
 <span class="text-xl font-bold font-heading text-brand-600">${currencyFormatter.format(s.price)}</span>
 <div class="flex gap-2">
 <button data-id="${s.id}" class="info-btn bg-white border border-ink-200 rounded-lg py-2 px-3 font-medium hover:bg-ink-50 focus-ring">Info</button>
 <button data-id="${s.id}" ${!alaCarteUnlocked ? 'aria-disabled="true" disabled' : ''} class="add-to-cart-btn bg-brand-50 text-brand-700 font-semibold py-2 px-4 rounded-lg hover:bg-brand-100 focus-ring">${!alaCarteUnlocked ? 'Locked' : 'Add'} <i class="fa-solid fa-plus ml-2"></i></button>
 </div>
 </div>
 ${!alaCarteUnlocked ? `<div class="lock-overlay"><i class="fa-solid fa-lock mr-2"></i>Requires a Core Program in cart or past purchase</div>` : ''}
 </article>`).join('');
 html += `</div></section>`;
 }
 productContainer.innerHTML = html;
 };

 /*********************
 * CART UI & CALC
 *********************/
 const updateCartUI = () => {
 // items area
 if (cart.length === 0) {
 cartItemsContainer.innerHTML = `<div class="text-center py-16 px-6"><i class="fa-solid fa-cart-arrow-down text-5xl text-ink-300"></i><h3 class="mt-4 text-xl font-bold text-ink-800">Your Cart is Empty</h3><p class="mt-1 text-ink-500">Add services to get started.</p></div>`;
 } else {
 cartItemsContainer.innerHTML = cart.map((item, index) => `
 <div class="py-3 border-b flex gap-4 items-center">
 <div class="flex-grow">
 <p class="font-semibold leading-tight">${item.name}</p>
 <p class="text-sm text-ink-500">${item.domain || ''}</p>
 </div>
 <div class="text-right">
 <p class="font-semibold">${currencyFormatter.format(item.price)}</p>
 <button data-index="${index}" class="remove-from-cart-btn text-xs text-rose-500 hover:underline mt-1">Remove</button>
 </div>
 </div>
 `).join('');
 }

 const subtotal = cart.reduce((sum, item) => sum + Number(item.price), 0);
 console.log("cartitems",cart)
 console.log("subtotal",subtotal)
 const discount = appliedCoupon ? appliedCoupon.amount : 0;

 if(appliedCoupon) {
 couponDisplayRow.classList.remove('hidden');
 document.getElementById('applied-coupon-pill').textContent = `${appliedCoupon.code} — ${currencyFormatter.format(appliedCoupon.amount)} off`;
 cartDiscountEl.textContent = `-${currencyFormatter.format(discount)}`;
 couponMsg.textContent = '';
 } else {
 couponDisplayRow.classList.add('hidden');
 cartDiscountEl.textContent = `-₹0`;
 }

 const taxableBase = Math.max(0, subtotal - discount);
 const gst = Math.round(taxableBase * 0.18);
 const platformFee = Math.round(taxableBase * 0.02);
 const total = Math.round(taxableBase + gst + platformFee);

 cartSubtotalEl.textContent = currencyFormatter.format(subtotal);
 cartGstEl.textContent = currencyFormatter.format(gst);
 cartPlatformFeeEl.textContent = currencyFormatter.format(platformFee);
 cartTotalEl.textContent = currencyFormatter.format(total);
 cartBadge.textContent = cart.length;
 cartBadge.classList.toggle('hidden', cart.length === 0);

 // disable coupon input when cart empty
 couponInput.disabled = cart.length === 0;
 applyCouponBtn.disabled = cart.length === 0;
 if (cart.length === 0) couponMsg.textContent = '';
 };

 /*********************
 * PRODUCT BUTTONS (Add / Info)
 *********************/
 productContainer.addEventListener('click', (e) => {
 const infoBtn = e.target.closest('.info-btn');
 if (infoBtn) {
 // show static info modal
 openInfoModal();
 return;
 }

 const addBtn = e.target.closest('.add-to-cart-btn');
 if (!addBtn) return;
 const serviceId = addBtn.dataset.id;
 const service = allServices.find(s => s.id == serviceId);
 if (!service) return;

 // alacarte lock check
 if (service.type === 'alacarte') {
 const isUnlocked = cart.some(item =>  item.type === 'core') || pastPurchaseCheckbox.checked;
 if (!isUnlocked) {
 showToast('Add a Core Program first or mark past purchase to unlock À La Carte services.', 'error', 4000);
 return;
 }
 }

 const card = document.getElementById(`service-${serviceId}`);
 let domain = null;
 if (service.applicableDomains) {
 const select = card.querySelector('.domain-select');
 if (select && !select.value) {
 // inline error UX instead of alert
 select.classList.add('border-rose-500');
 showToast('Please select a domain before adding to cart.', 'error', 3000);
 select.focus();
 setTimeout(() => select.classList.remove('border-rose-500'), 2000);
 return;
 }
 domain = select ? select.value : null;
 }

 const cartItemId = domain ? `${service.id}-${domain.replace(/\s+/g, '-')}` : service.id;
 if (cart.some(item => item.id == cartItemId)) {
 showToast('This specific service is already in your cart.', 'error', 2500);
 return;
 }

 const cartItem = { id: cartItemId, type:service.type,name: service.name, price: service.price, domain: domain };
 cart.push(cartItem);
 showToast(`${service.name} added to cart`, 'success', 2400);
 updateCartUI();
 renderProducts(document.querySelector('.filter-btn.bg-brand-600')?.dataset?.filter || 'all', searchInput.value.trim());
 });

 /*********************
 * REMOVE FROM CART
 *********************/
 cartItemsContainer.addEventListener('click', e => {
 if (!e.target.classList.contains('remove-from-cart-btn')) return;
 const idx = Number(e.target.dataset.index);
 if (Number.isNaN(idx)) return;
 const removed = cart.splice(idx, 1)[0];
 showToast(`${removed.name} removed`, 'success', 2000);
  const hasCore = cart.some(isCore);  
    if (!hasCore) {
        cart = cart.filter(item => !isAlacarte(item));  
    }

 updateCartUI();
 console.log("cartitems",cart)
 renderProducts(document.querySelector('.filter-btn.bg-brand-600')?.dataset?.filter || 'all', searchInput.value.trim());
 });

 /*********************
 * FILTERS
 *********************/
 document.getElementById('filters-container').addEventListener('click', (e) => {
 if (e.target.classList.contains('filter-btn')) {
 document.querySelectorAll('.filter-btn').forEach(btn => {
 btn.classList.remove('bg-brand-600', 'text-white');
 btn.classList.add('bg-white', 'hover:bg-ink-50', 'text-ink-700', 'border', 'border-ink-200');
 btn.setAttribute('aria-pressed', 'false');
 });
 e.target.classList.add('bg-brand-600', 'text-white');
 e.target.classList.remove('bg-white', 'hover:bg-ink-50', 'text-ink-700', 'border', 'border-ink-200');
 e.target.setAttribute('aria-pressed', 'true');
 renderProducts(e.target.dataset.filter, searchInput.value.trim());
 }
 });

 pastPurchaseCheckbox.addEventListener('change', () => {
 renderProducts(document.querySelector('.filter-btn.bg-brand-600')?.dataset?.filter || 'all', searchInput.value.trim());
 showToast(pastPurchaseCheckbox.checked ? 'À La Carte unlocked (past purchase)' : 'À La Carte locking re-enabled', 'success', 2000);
 });

 /*********************
 * COUPON HANDLING (unchanged codes)
 *********************/
 applyCouponBtn.addEventListener('click', () => {
 const code = couponInput.value.trim().toUpperCase();
 if (!code) {
 couponMsg.textContent = 'Please enter a coupon code.';
 couponMsg.className = 'text-xs mt-1.5 h-4 text-rose-500';
 return;
 }
 if (validCoupons[code]) {
 appliedCoupon = { code, amount: validCoupons[code] };
 couponMsg.textContent = `Success! "${code}" applied.`;
 couponMsg.className = 'text-xs mt-1.5 h-4 text-green-600';
 showToast(`Coupon ${code} applied — ${currencyFormatter.format(validCoupons[code])} off`, 'success', 2800);
 updateCartUI();
 } else {
 appliedCoupon = null;
 couponMsg.textContent = 'Invalid coupon code.';
 couponMsg.className = 'text-xs mt-1.5 h-4 text-rose-500';
 showToast('Coupon not valid', 'error', 2200);
 updateCartUI();
 }
 });
 document.getElementById('remove-coupon-btn').addEventListener('click', () => {
 appliedCoupon = null;
 couponMsg.textContent = '';
 renderProducts(document.querySelector('.filter-btn.bg-brand-600')?.dataset?.filter || 'all', searchInput.value.trim());
 updateCartUI();
 showToast('Coupon removed', 'success', 1600);
 });

 /*********************
 * CART SIDEBAR CONTROLS + FOCUS TRAP
 *********************/
 const openCart = () => {
 cartBackdrop.classList.remove('hidden');
 cartSidebar.classList.remove('translate-x-full');
 cartSidebar.setAttribute('aria-hidden', 'false');
 // focus trap basics: move focus to cart panel
 cartItemsContainer.focus();
 };
 const closeCart = () => { cartBackdrop.classList.add('hidden'); cartSidebar.classList.add('translate-x-full'); cartSidebar.setAttribute('aria-hidden', 'true'); };
 cartBtn.addEventListener('click', () => { openCart(); });
 closeCartBtn.addEventListener('click', closeCart);
 cartBackdrop.addEventListener('click', closeCart);

 // basic focus escape for cart and modal on Escape
 document.addEventListener('keydown', e => {
 if (e.key === 'Escape') {
 if (!cartSidebar.classList.contains('translate-x-full')) closeCart();
 modal.classList.add('hidden');
 }
 });

 /*********************
 * INFO MODAL (focus trap)
 *********************/
 const openInfoModal = () => {
 modal.classList.remove('hidden');
 const panel = document.getElementById('info-modal-panel');
 // trap focus (basic)
 const focusable = panel.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');
 const firstEl = focusable[0];
 const lastEl = focusable[focusable.length - 1];
 firstEl?.focus();
 // simple trap
 panel.addEventListener('keydown', (ev) => {
 if (ev.key !== 'Tab') return;
 if (ev.shiftKey && document.activeElement === firstEl) {
 ev.preventDefault();
 lastEl.focus();
 } else if (!ev.shiftKey && document.activeElement === lastEl) {
 ev.preventDefault();
 firstEl.focus();
 }
 }, { once: true });
 };
 const closeInfoModal = () => modal.classList.add('hidden');
 closeInfoModalBtn.addEventListener('click', closeInfoModal);
 closeInfoBtn.addEventListener('click', closeInfoModal);

 /*********************
 * SEARCH (debounced)
 *********************/
 const doSearch = (term) => {
 const currentFilter = document.querySelector('.filter-btn.bg-brand-600')?.dataset?.filter || 'all';
 renderProducts(currentFilter, term);
 };
 searchInput.addEventListener('input', (e) => {
 clearTimeout(searchTimeout);
 searchTimeout = setTimeout(() => doSearch(e.target.value.trim()), 320);
 });
 searchBtn.addEventListener('click', () => doSearch(searchInput.value.trim()));

                    const qs = sel => document.querySelector(sel);
                    const qsa = sel => document.querySelectorAll(sel);

                    let accessToken = localStorage.getItem('accessToken');
                    let refreshToken = localStorage.getItem('refreshToken');

                    let spinner = document.getElementById("spinner");
                    let content = document.querySelector('.content');

                    if (refreshToken) {


                                 try {
                        let response = await fetch('https://hiinterview-backend-1.onrender.com/api/userprofile/', {
                            method: 'GET',
                            headers: {
                                'Content-Type': 'application/json',
                                'Authorization': `Bearer ${accessToken}`
                            },

                        });

                        if (response.status === 401) {
                            accessToken = await refreshAccessToken();
                            if (!accessToken) return;
                            refreshToken = localStorage.getItem('refreshToken');
                            response = await fetch('https://hiinterview-backend-1.onrender.com/api/userprofile/', {
                                method: 'GET',
                                headers: {
                                    'Content-Type': 'application/json',
                                    'Authorization': `Bearer ${accessToken}`
                                },

                            });
                        }

                        if (response.status === 403) {
                            spinner.style.display = "none";
                            window.location.href = "404.html";
                        } else {
                            content.style.display = "block";
                            spinner.style.display = "none";

                        }

                        if (response.ok) {
                            const data = await response.json();
                            console.log("data:", data);
                         
                            if (data.profile_photo_url) {
                                const url = 'https://hiinterview-backend-1.onrender.com'
                                
                            profileInitial.style.display = "none";
                            qs("#profileAvatar").src = `${url}${data.profile_photo_url}`;
                            qs("#profileAvatar").style.display = "block";
                            qs("#profileInitial").style.display = "none";
                            } else {
                            profileInitial.style.display = "block";
                            const userInitial = data.fullname[0];
                            document.querySelector("#profileInitial").innerText = userInitial
                            }

                    
                        } else {
                            console.error('failed to fetch user data');
                        }
                    } catch (err) {
                        console.error(err);
                    }
                    } else{
                         content.style.display = "block";
                         spinner.style.display = "none";
                    }

                   





          async function refreshAccessToken() {
          const refreshToken = localStorage.getItem("refreshToken");
          if (!refreshToken) return null;

          try {
              const response = await fetch("https://hiinterview-backend-1.onrender.com/api/token/refresh/", {
                  method: "POST",
                  headers: { "Content-Type": "application/json" },
                  body: JSON.stringify({ refresh: refreshToken })
              });

              if (response.ok) {
                  const data = await response.json();
                  localStorage.setItem("accessToken", data.access);
                  localStorage.setItem("refreshToken", data.refresh);

                  return data.access;
              } else {
                  clearTokensAndRedirect();
                  return null;
              }
          } catch (err) {
              console.error(err);
              return null;
          }
      }

      function clearTokensAndRedirect() {
          localStorage.removeItem('accessToken');
          localStorage.removeItem('refreshToken');
          localStorage.removeItem('role')
          window.location.href = "login.html";
      }


      document.getElementById('checkout-btn').addEventListener('click',function(){

        if(cart.length==0){
            alert('add atleadt one item to cart')
            return
        }

            const totalAmount = document.getElementById("cart-total").textContent;
                localStorage.setItem("cart", JSON.stringify(cart));
                localStorage.setItem('total',totalAmount)
                window.location.href = "payment.html"

      })


let allServices = [];
async function fetchServices() {
    try {
        const res = await fetch('https://hiinterview-backend-1.onrender.com/api/services/');
        if (!res.ok) throw new Error('Failed to fetch services');
        allServices = await res.json();

    } catch (error) {
        console.error(error);
        showToast('Failed to load services', 'error', 3000);
    }
}



 /*********************
 * INIT
 *********************/
(async () => {
    initSlider();
    await fetchServices(); 
    renderProducts();      
    updateCartUI();
})();
 });
 </script>
</body>
</html>